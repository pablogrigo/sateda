<style>
    body {
      min-width:400px;
      overflow-x:hidden;
    }
    textarea {
      border:1px solid black;
      width:390px;
      height:350px;
    }
    button.primary {
        
    }
    button.secondary {
        
    }
</style>

<script src="jquery.js" type="text/javascript"></script>
<script>
    var j = jQuery;
     
    function save() {
        chrome.tabs.getSelected(null, function(tab) {
            chrome.tabs.sendRequest(
                tab.id, 
                {what: 'host'}, 
                function(response) {
                    localStorage.setItem(response.host, j('#code').val());
            });
        });
    }
    function test() {
        eval(j('#code').val());
    }
    function remove() {
        chrome.tabs.getSelected(null, function(tab) {
            chrome.tabs.sendRequest(
                tab.id, 
                {what: 'host'}, 
                function(response) {
                    localStorage.removeItem(response.host);
            });
        });
    }
    
    chrome.tabs.getSelected(null, function(tab) {
        chrome.tabs.sendRequest(
            tab.id, 
            {what: 'host'}, 
            function(response) {
                j('#code').val(localStorage.getItem(response.host));
        });
    });
    
</script>

<textarea id="code"></textarea>
<br />
<button id="save" class="primary" onclick="save();">Save</button>
<button id="test" class="secondary" onclick="test();">Test</button>
<button id="test" class="secondary" onclick="remove();">Remove for this site</button>
