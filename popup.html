<style>
    body {
      min-width: 400px;
      overflow-x: hidden;
    }
    textarea {
      border: 1px solid black;
      width: 390px;
      height: 350px;
    }
    button.primary {
        
    }
    button.secondary {
        
    }
</style>


<script src="jquery.js" type="text/javascript"></script>
<script>
    var j = jQuery;
     
    function executeWithHost(callback) {
        chrome.tabs.getSelected(null, function(tab) {
            chrome.tabs.sendRequest(
                tab.id, 
                {what: 'host'}, 
                function(response) {
                    callback(response.host);
            });
        });
    }
    
    function save() {
        executeWithHost(function(host) {
            localStorage.setItem(host, j('#code').val());
        });
    }
    function test() {
        // eval(j('#code').val());
    }
    function remove() {
        executeWithHost(function(host) {
            localStorage.removeItem(host);
            j('#code').val('');
        });
    }
    
    
    //load the actual code for this site
    executeWithHost(function(host) {
        j('#code').val(localStorage.getItem(host));
    });
</script>

<textarea id="code"></textarea>
<br />
<button id="save" class="primary" onclick="save();">Save</button>
<button id="test" class="secondary" onclick="test();">Test</button>
<button id="test" class="secondary" onclick="remove();">Remove for this site</button>
